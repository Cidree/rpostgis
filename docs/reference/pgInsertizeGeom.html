<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Format R data objects for insert into a PostgreSQL table. — pgInsertizeGeom • rpostgis</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous"><link href="../docsearch.css" rel="stylesheet"><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><script src="../extra.js"></script><meta property="og:title" content="Format R data objects for insert into a PostgreSQL table. — pgInsertizeGeom"><meta property="og:description" content="These are internal rpostgis functions that take an R sp or sf object (Spatial*,
Spatial*DataFrame or sf; for pgInsertizeGeom), or data frame (for
pgInsertize) and return a pgi list object, which can
be used in the function pgInsert to insert rows of the
object into the database table. (Note that these functions do not
do any modification of the database, it only prepares the data for
insert.) The function pgInsert is a wrapper around these
functions, so pgInsertize* should only be used in
situations where data preparation and insert need to be separated."><meta property="og:image" content="https://mablab.org/rpostgis/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rpostgis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/mablab/rpostgis" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://mablab.org/" class="external-link">MabLab</a>
</li>
      </ul><form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off"></div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Format R data objects for insert into a PostgreSQL table.</h1>
    <small class="dont-index">Source: <a href="https://github.com/mablab/rpostgis/blob/HEAD/R/pgInsertize.R" class="external-link"><code>R/pgInsertize.R</code></a></small>
    <div class="hidden name"><code>pgInsertizeGeom.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>These are internal rpostgis functions that take an R <code>sp</code> or <code>sf</code> object (Spatial*,
Spatial*DataFrame or sf; for <code>pgInsertizeGeom</code>), or data frame (for
<code>pgInsertize</code>) and return a <code>pgi</code> list object, which can
be used in the function <code>pgInsert</code> to insert rows of the
object into the database table. (Note that these functions do not
do any modification of the database, it only prepares the data for
insert.) The function <code>pgInsert</code> is a wrapper around these
functions, so <code>pgInsertize*</code> should only be used in
situations where data preparation and insert need to be separated.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pgInsertizeGeom</span><span class="op">(</span></span>
<span>  <span class="va">data.obj</span>,</span>
<span>  geom <span class="op">=</span> <span class="st">"geometry"</span>,</span>
<span>  create.table <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  force.match <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  conn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  new.id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  alter.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  partial.match <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  df.mode <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  geog <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pgInsertize</span><span class="op">(</span></span>
<span>  <span class="va">data.obj</span>,</span>
<span>  create.table <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  force.match <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  conn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  new.id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  alter.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  partial.match <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  df.mode <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data.obj</dt>
<dd><p>A Spatial* or Spatial*DataFrame, or data frame for
<code>pgInsertize</code>.</p></dd>


<dt>geom</dt>
<dd><p>character string, the name of geometry column in the
database table. (existing or to be created; defaults to
'geom').</p></dd>


<dt>create.table</dt>
<dd><p>character, schema and table of the PostgreSQL
table to create (actual table creation will be done in later
in pgWriteGeom().) Column names will be converted to
PostgreSQL-compliant names. Default is <code>NULL</code> (no new
table created).</p></dd>


<dt>force.match</dt>
<dd><p>character, schema and table of the PostgreSQL
table to compare columns of data frame with.  If specified with
<code>partial.match = TRUE</code>
only columns in the data frame that exactly match the database
table will be kept, and reordered to match the database
table. If <code>NULL</code>, all columns will be kept in the same
order given in the data frame.</p></dd>


<dt>conn</dt>
<dd><p>A database connection (if a table is given in for
"force.match" parameter)</p></dd>


<dt>new.id</dt>
<dd><p>character, name of a new sequential integer ID
column to be added to the table.  (for spatial objects without
data frames, this column is created even if left <code>NULL</code>
and defaults to the name <code>"gid"</code>).</p></dd>


<dt>row.names</dt>
<dd><p>Whether to add the data frame row names to the 
database table. Column name will be '.R_rownames'.</p></dd>


<dt>alter.names</dt>
<dd><p>Logical, whether to make database column names
DB-compliant (remove special characters). Default is
<code>TRUE</code>.  (This should to be set to <code>FALSE</code> to match
to non-standard names in an existing database table using the
<code>force.match</code> setting.)</p></dd>


<dt>partial.match</dt>
<dd><p>Logical; if force.match is set and  true, 
columns in R data frame will be compared with an the 
existing database table <code>name</code>. Only columns in the 
data frame that exactly match the database
table will be inserted into the database table.</p></dd>


<dt>df.mode</dt>
<dd><p>Logical; Whether to write data in data frame mode 
(preserving data frame column attributes and row.names).
A new table must be created with this mode (or overwrite set to TRUE),
and the row.names, alter.names, and new.id arguments will
be ignored (see <code>dbWriteDataFrame</code> for more information.</p></dd>


<dt>geog</dt>
<dd><p>Logical; Whether to write the spatial data as a PostGIS 
'GEOGRAPHY' type.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>pgi A list containing four character strings: (1)
    in.table, the table name which will be created or inserted
    into, if specified by either create.table or force.match (else
    NULL) (2) db.new.table, the SQL statement to create the new
    table, if specified in create.table (else NULL), (3)
    db.cols.insert, a character string of the database column
    names to insert into, and (4) insert.data, a character string
    of the data to insert. See examples for usage within the</p>
<p></p>
<p><code>pgInsert</code> function.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The entire data frame is prepared by default, unless
<code>force.match</code> specifies a database table (along with a
database connection <code>conn</code>), in which case the R column names
are compared to the <code>force.match</code> column names, and only
exact matches are formatted to be inserted.</p>
<p>A new database table can also be prepared to be created using the
<code>create.table</code> argument.  If <code>new.id</code> is specified, a
new sequential integer field is added to the data frame.  For
<code>Spatial*</code>-only objects (no data frame), a new.id is created
by default with name <code>gid</code>.  For <code>pgInsertizeGeom</code>, if
the R package <code>wkb</code> is installed, this function uses
<code>writeWKB</code> to translate the geometries for some spatial types
(faster with large datasets), otherwise the <code>rgeos</code> function
<code>writeWKT</code> is used.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>David Bucklin <a href="mailto:david.bucklin@gmail.com">david.bucklin@gmail.com</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">meuse</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html" class="external-link">SpatialPoints</a></span><span class="op">(</span><span class="va">meuse</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">spdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html" class="external-link">SpatialPointsDataFrame</a></span><span class="op">(</span><span class="va">coords</span>, <span class="va">meuse</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Format data for insert</span></span></span>
<span class="r-in"><span><span class="va">pgi.new</span> <span class="op">&lt;-</span> <span class="fu">pgInsertizeGeom</span><span class="op">(</span><span class="va">spdf</span>, geom <span class="op">=</span> <span class="st">"point_geom"</span>, create.table <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"schema"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"table"</span><span class="op">)</span>, new.id <span class="op">=</span> <span class="st">"pt_gid"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pgi.new</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Insert data in database table (note that an error will be given if</span></span></span>
<span class="r-in"><span><span class="co">## all insert columns do not have exactly matching database table</span></span></span>
<span class="r-in"><span><span class="co">## columns)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="pgWriteGeom.html">pgWriteGeom</a></span><span class="op">(</span>conn <span class="op">=</span> <span class="va">conn</span>, data.obj <span class="op">=</span> <span class="va">pgi.new</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Inserting into existing table</span></span></span>
<span class="r-in"><span><span class="va">pgi.existing</span> <span class="op">&lt;-</span> <span class="fu">pgInsertizeGeom</span><span class="op">(</span><span class="va">spdf</span>, geom <span class="op">=</span> <span class="st">"point_geom"</span>, force.match <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"schema"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"table"</span><span class="op">)</span>, conn <span class="op">=</span> <span class="va">conn</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## A warning message is given, since the "dist.m" column is not found</span></span></span>
<span class="r-in"><span><span class="co">## in the database table (it was changed to "dist_m" in pgi.new to</span></span></span>
<span class="r-in"><span><span class="co">## make name DB-compliant). All other columns are prepared for insert.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pgi.existing</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="pgWriteGeom.html">pgWriteGeom</a></span><span class="op">(</span>conn <span class="op">=</span> <span class="va">conn</span>, data.obj <span class="op">=</span> <span class="va">pgi.existing</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## Format regular (non-spatial) data frame for insert using</span></span></span>
<span class="r-in"><span><span class="co">## pgInsertize connect to database</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="cn">NA</span>, <span class="fl">6</span><span class="op">)</span>, c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>,</span></span>
<span class="r-in"><span>    <span class="st">"text"</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Format non-spatial data frame for insert</span></span></span>
<span class="r-in"><span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu">pgInsertize</span><span class="op">(</span>data.obj <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Insert data in database table (note that an error will be given if</span></span></span>
<span class="r-in"><span><span class="co">## all insert columns do not match exactly to database table columns)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="pgWriteGeom.html">pgWriteGeom</a></span><span class="op">(</span><span class="va">conn</span>, data.obj <span class="op">=</span> <span class="va">values</span>, name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"schema"</span>, <span class="st">"table"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Run with forced matching of database table column names</span></span></span>
<span class="r-in"><span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu">pgInsertize</span><span class="op">(</span>data.obj <span class="op">=</span> <span class="va">data</span>, force.match <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"schema"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"table"</span><span class="op">)</span>, conn <span class="op">=</span> <span class="va">conn</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="pgWriteGeom.html">pgWriteGeom</a></span><span class="op">(</span><span class="va">conn</span>, data.obj <span class="op">=</span> <span class="va">values</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://mablab.org" class="external-link">Mathieu Basille</a>, <a href="https://mablab.org/people/david-bucklin/" class="external-link">David Bucklin</a>, <a href="https://adrian-cidre.com/" class="external-link">Adrián Cidre González</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '91afe5231e730105b1d4b94b1f9ad15b',
    indexName: 'rpostgis',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script></body></html>


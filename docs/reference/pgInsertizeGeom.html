<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Format R data objects for insert into a PostgreSQL table. — pgInsertizeGeom • rpostgis</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Merriweather-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Format R data objects for insert into a PostgreSQL table. — pgInsertizeGeom"><meta name="description" content="These are internal rpostgis functions that take an R sp or sf object (Spatial*,
Spatial*DataFrame or sf; for pgInsertizeGeom), or data frame (for
pgInsertize) and return a pgi list object, which can
be used in the function pgInsert to insert rows of the
object into the database table. (Note that these functions do not
do any modification of the database, it only prepares the data for
insert.) The function pgInsert is a wrapper around these
functions, so pgInsertize* should only be used in
situations where data preparation and insert need to be separated."><meta property="og:description" content="These are internal rpostgis functions that take an R sp or sf object (Spatial*,
Spatial*DataFrame or sf; for pgInsertizeGeom), or data frame (for
pgInsertize) and return a pgi list object, which can
be used in the function pgInsert to insert rows of the
object into the database table. (Note that these functions do not
do any modification of the database, it only prepares the data for
insert.) The function pgInsert is a wrapper around these
functions, so pgInsertize* should only be used in
situations where data preparation and insert need to be separated."><meta property="og:image" content="https://cidree.github.io/rpostgis/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rpostgis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.1.900</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/Cidree/rpostgis"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Format R data objects for insert into a PostgreSQL table.</h1>
      <small class="dont-index">Source: <a href="https://github.com/Cidree/rpostgis/blob/HEAD/R/pgInsertize.R" class="external-link"><code>R/pgInsertize.R</code></a></small>
      <div class="d-none name"><code>pgInsertizeGeom.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>These are internal rpostgis functions that take an R <code>sp</code> or <code>sf</code> object (Spatial*,
Spatial*DataFrame or sf; for <code>pgInsertizeGeom</code>), or data frame (for
<code>pgInsertize</code>) and return a <code>pgi</code> list object, which can
be used in the function <code>pgInsert</code> to insert rows of the
object into the database table. (Note that these functions do not
do any modification of the database, it only prepares the data for
insert.) The function <code>pgInsert</code> is a wrapper around these
functions, so <code>pgInsertize*</code> should only be used in
situations where data preparation and insert need to be separated.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pgInsertizeGeom</span><span class="op">(</span></span>
<span>  <span class="va">data.obj</span>,</span>
<span>  geom <span class="op">=</span> <span class="st">"geometry"</span>,</span>
<span>  create.table <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  force.match <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  conn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  new.id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  alter.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  partial.match <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  df.mode <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  geog <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pgInsertize</span><span class="op">(</span></span>
<span>  <span class="va">data.obj</span>,</span>
<span>  create.table <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  force.match <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  conn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  new.id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  alter.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  partial.match <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  df.mode <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data-obj">data.obj<a class="anchor" aria-label="anchor" href="#arg-data-obj"></a></dt>
<dd><p>A Spatial* or Spatial*DataFrame, or data frame for
<code>pgInsertize</code>.</p></dd>


<dt id="arg-geom">geom<a class="anchor" aria-label="anchor" href="#arg-geom"></a></dt>
<dd><p>character string, the name of geometry column in the
database table. (existing or to be created; defaults to
'geom').</p></dd>


<dt id="arg-create-table">create.table<a class="anchor" aria-label="anchor" href="#arg-create-table"></a></dt>
<dd><p>character, schema and table of the PostgreSQL
table to create (actual table creation will be done in later
in pgWriteGeom().) Column names will be converted to
PostgreSQL-compliant names. Default is <code>NULL</code> (no new
table created).</p></dd>


<dt id="arg-force-match">force.match<a class="anchor" aria-label="anchor" href="#arg-force-match"></a></dt>
<dd><p>character, schema and table of the PostgreSQL
table to compare columns of data frame with.  If specified with
<code>partial.match = TRUE</code>
only columns in the data frame that exactly match the database
table will be kept, and reordered to match the database
table. If <code>NULL</code>, all columns will be kept in the same
order given in the data frame.</p></dd>


<dt id="arg-conn">conn<a class="anchor" aria-label="anchor" href="#arg-conn"></a></dt>
<dd><p>A database connection (if a table is given in for
"force.match" parameter)</p></dd>


<dt id="arg-new-id">new.id<a class="anchor" aria-label="anchor" href="#arg-new-id"></a></dt>
<dd><p>character, name of a new sequential integer ID
column to be added to the table.  (for spatial objects without
data frames, this column is created even if left <code>NULL</code>
and defaults to the name <code>"gid"</code>).</p></dd>


<dt id="arg-row-names">row.names<a class="anchor" aria-label="anchor" href="#arg-row-names"></a></dt>
<dd><p>Whether to add the data frame row names to the
database table. Column name will be '.R_rownames'.</p></dd>


<dt id="arg-alter-names">alter.names<a class="anchor" aria-label="anchor" href="#arg-alter-names"></a></dt>
<dd><p>Logical, whether to make database column names
DB-compliant (remove special characters). Default is
<code>TRUE</code>.  (This should to be set to <code>FALSE</code> to match
to non-standard names in an existing database table using the
<code>force.match</code> setting.)</p></dd>


<dt id="arg-partial-match">partial.match<a class="anchor" aria-label="anchor" href="#arg-partial-match"></a></dt>
<dd><p>Logical; if force.match is set and  true,
columns in R data frame will be compared with an the
existing database table <code>name</code>. Only columns in the
data frame that exactly match the database
table will be inserted into the database table.</p></dd>


<dt id="arg-df-mode">df.mode<a class="anchor" aria-label="anchor" href="#arg-df-mode"></a></dt>
<dd><p>Logical; Whether to write data in data frame mode
(preserving data frame column attributes and row.names).
A new table must be created with this mode (or overwrite set to TRUE),
and the row.names, alter.names, and new.id arguments will
be ignored (see <code>dbWriteDataFrame</code> for more information.</p></dd>


<dt id="arg-geog">geog<a class="anchor" aria-label="anchor" href="#arg-geog"></a></dt>
<dd><p>Logical; Whether to write the spatial data as a PostGIS
'GEOGRAPHY' type.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>pgi A list containing four character strings: (1)
    in.table, the table name which will be created or inserted
    into, if specified by either create.table or force.match (else
    NULL) (2) db.new.table, the SQL statement to create the new
    table, if specified in create.table (else NULL), (3)
    db.cols.insert, a character string of the database column
    names to insert into, and (4) insert.data, a character string
    of the data to insert. See examples for usage within the
    <code>pgInsert</code> function.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The entire data frame is prepared by default, unless
<code>force.match</code> specifies a database table (along with a
database connection <code>conn</code>), in which case the R column names
are compared to the <code>force.match</code> column names, and only
exact matches are formatted to be inserted.</p>
<p>A new database table can also be prepared to be created using the
<code>create.table</code> argument.  If <code>new.id</code> is specified, a
new sequential integer field is added to the data frame.  For
<code>Spatial*</code>-only objects (no data frame), a new.id is created
by default with name <code>gid</code>.  For <code>pgInsertizeGeom</code>, if
the R package <code>wkb</code> is installed, this function uses
<code>writeWKB</code> to translate the geometries for some spatial types
(faster with large datasets), otherwise the <code>rgeos</code> function
<code>writeWKT</code> is used.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David Bucklin <a href="mailto:david.bucklin@gmail.com">david.bucklin@gmail.com</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">meuse</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://edzer.github.io/sp/reference/SpatialPoints.html" class="external-link">SpatialPoints</a></span><span class="op">(</span><span class="va">meuse</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">spdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://edzer.github.io/sp/reference/SpatialPoints.html" class="external-link">SpatialPointsDataFrame</a></span><span class="op">(</span><span class="va">coords</span>, <span class="va">meuse</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Format data for insert</span></span></span>
<span class="r-in"><span><span class="va">pgi.new</span> <span class="op">&lt;-</span> <span class="fu">pgInsertizeGeom</span><span class="op">(</span><span class="va">spdf</span>, geom <span class="op">=</span> <span class="st">"point_geom"</span>, create.table <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"schema"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"table"</span><span class="op">)</span>, new.id <span class="op">=</span> <span class="st">"pt_gid"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pgi.new</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Insert data in database table (note that an error will be given if</span></span></span>
<span class="r-in"><span><span class="co">## all insert columns do not have exactly matching database table</span></span></span>
<span class="r-in"><span><span class="co">## columns)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="pgWriteGeom.html">pgWriteGeom</a></span><span class="op">(</span>conn <span class="op">=</span> <span class="va">conn</span>, data.obj <span class="op">=</span> <span class="va">pgi.new</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Inserting into existing table</span></span></span>
<span class="r-in"><span><span class="va">pgi.existing</span> <span class="op">&lt;-</span> <span class="fu">pgInsertizeGeom</span><span class="op">(</span><span class="va">spdf</span>, geom <span class="op">=</span> <span class="st">"point_geom"</span>, force.match <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"schema"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"table"</span><span class="op">)</span>, conn <span class="op">=</span> <span class="va">conn</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## A warning message is given, since the "dist.m" column is not found</span></span></span>
<span class="r-in"><span><span class="co">## in the database table (it was changed to "dist_m" in pgi.new to</span></span></span>
<span class="r-in"><span><span class="co">## make name DB-compliant). All other columns are prepared for insert.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pgi.existing</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="pgWriteGeom.html">pgWriteGeom</a></span><span class="op">(</span>conn <span class="op">=</span> <span class="va">conn</span>, data.obj <span class="op">=</span> <span class="va">pgi.existing</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co">## Format regular (non-spatial) data frame for insert using</span></span></span>
<span class="r-in"><span><span class="co">## pgInsertize connect to database</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="cn">NA</span>, <span class="fl">6</span><span class="op">)</span>, c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>,</span></span>
<span class="r-in"><span>    <span class="st">"text"</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Format non-spatial data frame for insert</span></span></span>
<span class="r-in"><span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu">pgInsertize</span><span class="op">(</span>data.obj <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Insert data in database table (note that an error will be given if</span></span></span>
<span class="r-in"><span><span class="co">## all insert columns do not match exactly to database table columns)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="pgWriteGeom.html">pgWriteGeom</a></span><span class="op">(</span><span class="va">conn</span>, data.obj <span class="op">=</span> <span class="va">values</span>, name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"schema"</span>, <span class="st">"table"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Run with forced matching of database table column names</span></span></span>
<span class="r-in"><span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu">pgInsertize</span><span class="op">(</span>data.obj <span class="op">=</span> <span class="va">data</span>, force.match <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"schema"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"table"</span><span class="op">)</span>, conn <span class="op">=</span> <span class="va">conn</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="pgWriteGeom.html">pgWriteGeom</a></span><span class="op">(</span><span class="va">conn</span>, data.obj <span class="op">=</span> <span class="va">values</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://adrian-cidre.com/" class="external-link">Adrián Cidre González</a>, <a href="https://mablab.org" class="external-link">Mathieu Basille</a>, <a href="https://mablab.org/people/david-bucklin/" class="external-link">David Bucklin</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>


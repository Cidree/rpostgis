<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Format R data objects for insert into a PostgreSQL table. — pgInsertizeGeom • rpostgis</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>


  
  <script src="../extra.js"></script>
<meta property="og:title" content="Format R data objects for insert into a PostgreSQL table. — pgInsertizeGeom" />

<meta property="og:description" content="These are internal rpostgis functions that take an R sp object (Spatial* or
Spatial*DataFrame; for pgInsertizeGeom) or data frame (for
pgInsertize) and return a pgi list object, which can
be used in the function pgInsert to insert rows of the
object into the database table. (Note that these functions do not
do any modification of the database, it only prepares the data for
insert.) The function pgInsert is a wrapper around these
functions, so pgInsertize* should only be used in
situations where data preparation and insert need to be separated." />

<meta property="og:image" content="https://mablab.org/rpostgis/logo.png" />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rpostgis</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/mablab/rpostgis">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://mablab.org/">MabLab</a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Format R data objects for insert into a PostgreSQL table.</h1>
    
    <div class="hidden name"><code>pgInsertizeGeom.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>These are internal rpostgis functions that take an R <code>sp</code> object (Spatial* or
Spatial*DataFrame; for <code>pgInsertizeGeom</code>) or data frame (for
<code>pgInsertize</code>) and return a <code>pgi</code> list object, which can
be used in the function <code>pgInsert</code> to insert rows of the
object into the database table. (Note that these functions do not
do any modification of the database, it only prepares the data for
insert.) The function <code>pgInsert</code> is a wrapper around these
functions, so <code>pgInsertize*</code> should only be used in
situations where data preparation and insert need to be separated.</p>
    
    </div>

    <pre class="usage"><span class='fu'>pgInsertizeGeom</span>(<span class='no'>data.obj</span>, <span class='kw'>geom</span> <span class='kw'>=</span> <span class='st'>"geom"</span>, <span class='kw'>create.table</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>force.match</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>conn</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>new.id</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>row.names</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>alter.names</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>partial.match</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>df.mode</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>geog</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='fu'>pgInsertize</span>(<span class='no'>data.obj</span>, <span class='kw'>create.table</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>force.match</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>conn</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>new.id</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>row.names</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>alter.names</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>partial.match</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>df.mode</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data.obj</th>
      <td><p>A Spatial* or Spatial*DataFrame, or data frame for
<code>pgInsertize</code>.</p></td>
    </tr>
    <tr>
      <th>geom</th>
      <td><p>character string, the name of geometry column in the
database table. (existing or to be created; defaults to
'geom').</p></td>
    </tr>
    <tr>
      <th>create.table</th>
      <td><p>character, schema and table of the PostgreSQL
table to create (actual table creation will be done in later
in pgInsert().) Column names will be converted to
PostgreSQL-compliant names. Default is <code>NULL</code> (no new
table created).</p></td>
    </tr>
    <tr>
      <th>force.match</th>
      <td><p>character, schema and table of the PostgreSQL
table to compare columns of data frame with.  If specified with
<code>partial.match = TRUE</code>
only columns in the data frame that exactly match the database
table will be kept, and reordered to match the database
table. If <code>NULL</code>, all columns will be kept in the same
order given in the data frame.</p></td>
    </tr>
    <tr>
      <th>conn</th>
      <td><p>A database connection (if a table is given in for
"force.match" parameter)</p></td>
    </tr>
    <tr>
      <th>new.id</th>
      <td><p>character, name of a new sequential integer ID
column to be added to the table.  (for spatial objects without
data frames, this column is created even if left <code>NULL</code>
and defaults to the name <code>"gid"</code>).</p></td>
    </tr>
    <tr>
      <th>row.names</th>
      <td><p>Whether to add the data frame row names to the 
database table. Column name will be '.R_rownames'.</p></td>
    </tr>
    <tr>
      <th>alter.names</th>
      <td><p>Logical, whether to make database column names
DB-compliant (remove special characters). Default is
<code>TRUE</code>.  (This should to be set to <code>FALSE</code> to match
to non-standard names in an existing database table using the
<code>force.match</code> setting.)</p></td>
    </tr>
    <tr>
      <th>partial.match</th>
      <td><p>Logical; if force.match is set and  true, 
columns in R data frame will be compared with an the 
existing database table <code>name</code>. Only columns in the 
data frame that exactly match the database
table will be inserted into the database table.</p></td>
    </tr>
    <tr>
      <th>df.mode</th>
      <td><p>Logical; Whether to write data in data frame mode 
(preserving data frame column attributes and row.names).
A new table must be created with this mode (or overwrite set to TRUE),
and the row.names, alter.names, and new.id arguments will
be ignored (see <code>dbWriteDataFrame</code> for more information.</p></td>
    </tr>
    <tr>
      <th>geog</th>
      <td><p>Logical; Whether to write the spatial data as a PostGIS 
'GEOGRPAHY' type.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>pgi A list containing four character strings: (1)
    in.table, the table name which will be created or inserted
    into, if specified by either create.table or force.match (else
    NULL) (2) db.new.table, the SQL statement to create the new
    table, if specified in create.table (else NULL), (3)
    db.cols.insert, a character string of the database column
    names to insert into, and (4) insert.data, a character string
    of the data to insert. See examples for usage within the
    <code>pgInsert</code> function.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The entire data frame is prepared by default, unless
<code>force.match</code> specifies a database table (along with a
database connection <code>conn</code>), in which case the R column names
are compared to the <code>force.match</code> column names, and only
exact matches are formatted to be inserted.</p>
<p>A new database table can also be prepared to be created using the
<code>create.table</code> argument.  If <code>new.id</code> is specified, a
new sequential integer field is added to the data frame.  For
<code>Spatial*</code>-only objects (no data frame), a new.id is created
by default with name <code>gid</code>.  For <code>pgInsertizeGeom</code>, if
the R package <code>wkb</code> is installed, this function uses
<code>writeWKB</code> to translate the geometries for some spatial types
(faster with large datasets), otherwise the <code>rgeos</code> function
<code>writeWKT</code> is used.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='fu'>library</span>(<span class='no'>sp</span>)
<span class='fu'>data</span>(<span class='no'>meuse</span>)
<span class='no'>coords</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/sp/topics/SpatialPoints'>SpatialPoints</a></span>(<span class='no'>meuse</span>[, <span class='fu'>c</span>(<span class='st'>"x"</span>, <span class='st'>"y"</span>)])
<span class='no'>spdf</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/sp/topics/SpatialPoints'>SpatialPointsDataFrame</a></span>(<span class='no'>coords</span>, <span class='no'>meuse</span>)

<span class='co'>## Format data for insert</span>
<span class='no'>pgi.new</span> <span class='kw'>&lt;-</span> <span class='fu'>pgInsertizeGeom</span>(<span class='no'>spdf</span>, <span class='kw'>geom</span> <span class='kw'>=</span> <span class='st'>"point_geom"</span>, <span class='kw'>create.table</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"schema"</span>,
    <span class='st'>"table"</span>), <span class='kw'>new.id</span> <span class='kw'>=</span> <span class='st'>"pt_gid"</span>)
<span class='fu'>print</span>(<span class='no'>pgi.new</span>)

<span class='co'>## Insert data in database table (note that an error will be given if</span>
<span class='co'>## all insert columns do not have exactly matching database table</span>
<span class='co'>## columns)</span>
<span class='fu'><a href='pgInsert.html'>pgInsert</a></span>(<span class='kw'>conn</span> <span class='kw'>=</span> <span class='no'>conn</span>, <span class='kw'>data.obj</span> <span class='kw'>=</span> <span class='no'>pgi.new</span>)

<span class='co'>## Inserting into existing table</span>
<span class='no'>pgi.existing</span> <span class='kw'>&lt;-</span> <span class='fu'>pgInsertizeGeom</span>(<span class='no'>spdf</span>, <span class='kw'>geom</span> <span class='kw'>=</span> <span class='st'>"point_geom"</span>, <span class='kw'>force.match</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"schema"</span>,
    <span class='st'>"table"</span>), <span class='kw'>conn</span> <span class='kw'>=</span> <span class='no'>conn</span>)
<span class='co'>## A warning message is given, since the "dist.m" column is not found</span>
<span class='co'>## in the database table (it was changed to "dist_m" in pgi.new to</span>
<span class='co'>## make name DB-compliant). All other columns are prepared for insert.</span>
<span class='fu'>print</span>(<span class='no'>pgi.existing</span>)

<span class='fu'><a href='pgInsert.html'>pgInsert</a></span>(<span class='kw'>conn</span> <span class='kw'>=</span> <span class='no'>conn</span>, <span class='kw'>data.obj</span> <span class='kw'>=</span> <span class='no'>pgi.existing</span>)
<span class='co'># }</span><span class='co'># NOT RUN {</span>
<span class='co'>## Format regular (non-spatial) data frame for insert using</span>
<span class='co'>## pgInsertize connect to database</span>
<span class='no'>data</span> <span class='kw'>&lt;-</span> <span class='fu'>data.frame</span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>), <span class='kw'>b</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>4</span>, <span class='fl'>NA</span>, <span class='fl'>6</span>), <span class='kw'>c</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>7</span>,
    <span class='st'>"text"</span>, <span class='fl'>9</span>))

<span class='co'>## Format non-spatial data frame for insert</span>
<span class='no'>values</span> <span class='kw'>&lt;-</span> <span class='fu'>pgInsertize</span>(<span class='kw'>data.obj</span> <span class='kw'>=</span> <span class='no'>data</span>)

<span class='co'>## Insert data in database table (note that an error will be given if</span>
<span class='co'>## all insert columns do not match exactly to database table columns)</span>
<span class='fu'><a href='pgInsert.html'>pgInsert</a></span>(<span class='no'>conn</span>, <span class='kw'>data.obj</span> <span class='kw'>=</span> <span class='no'>values</span>, <span class='kw'>name</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"schema"</span>, <span class='st'>"table"</span>))

<span class='co'>## Run with forced matching of database table column names</span>
<span class='no'>values</span> <span class='kw'>&lt;-</span> <span class='fu'>pgInsertize</span>(<span class='kw'>data.obj</span> <span class='kw'>=</span> <span class='no'>data</span>, <span class='kw'>force.match</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"schema"</span>,
    <span class='st'>"table"</span>), <span class='kw'>conn</span> <span class='kw'>=</span> <span class='no'>conn</span>)

<span class='fu'><a href='pgInsert.html'>pgInsert</a></span>(<span class='no'>conn</span>, <span class='kw'>data.obj</span> <span class='kw'>=</span> <span class='no'>values</span>)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
David Bucklin <a href='mailto:david.bucklin@gmail.com'>david.bucklin@gmail.com</a>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Mathieu Basille, David Bucklin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  docsearch({
    
    
    apiKey: 'API_KEY',
    indexName: 'INDEX_NAME',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>


  </body>
</html>

